Ao. vastaukset ovat osa kotitehtävää h3 Haaga-Helian tunkeutumistestaus-kurssilla, jota opettaa Tero Karvinen.

## x) Lue ja tiivistä. Muutama ranskalainen viiva riittää.

### Popov 2024: Hacktricks: Wireshark tricks

- Hacktricks sivulla on vinkkejä Wireshark-ohjelman käyttämiseen.
- Sivun alussa on linkattuna tutoriaaleja, jotka kattavat wiresharkin perusteiden käyttöä, ja vinkkejä siihen.
- Analyze --> Expert Information näyttää katsauksen analysoituihin paketteihin.
- CTRL+f voi hakea pakettien sisältöä
- Host HTTP headerin saa näkyviin apply as column-filtterillä

### Karvinen 2023: Find Hidden Web Directories - Fuzz URLs with ffuf
- webservereillä on usein salaisia directoryja(hakemisto), joihin ei ole olemassa valmiita linkkejä. Näitä voisi kokeilla etsiä manuaalisesti, esim /sercret, /.cvn, mutta fuffilla tämän voi tehdä nopeasti yhdellä työkalulla.
- Fuff on joohoin kehittämä web fuzzeri
- Artikkelissa opastetaan miten Fuffilla voi fuzzata hakemistoja, mutta Fuffia voi käyttää myös esim headereihin. post parametreihin, yms.


## a) Valitse valmis hyökkäys. Ota sellainen hyökkäys, jonka saat toimimaan omaan paikalliseen harjoitusmaaliin, kuten Metasploitableen. Demonstroi hyökkäyksen toiminta.

Aloitan nyt helpolla vaihtoehdolla, ja otan alkuun VSFTPD backdoorin. Mikäli ehdin vielä ennen palautusta, otan jonkun toisen hyökkäyksen.

## b) Sorsa. Selitä ja arvioi valitsemasi hyökkäyksen toimintaa lähdekoodista.

Kaivan VSFTPD lähdekoodin, jota katsottiinkin jo hieman tunnilla. 

![image](https://github.com/user-attachments/assets/67e35b77-847e-4ca0-b9e7-ec6be249110a)

![image](https://github.com/user-attachments/assets/7ddd75c4-906b-48d1-895f-48cc0f3deb22)

// Jatkuu toisena päivänä.

Yritän avata uusiksi lähdekoodia, mutta saan nyt virheilmoituksen;
![image](https://github.com/user-attachments/assets/7c44da37-8476-40f3-a934-a19fb6a70e40)

Edit anyway. 

Koodissa :) laitettuna usernamen perään aktivoi hyökkäyksen, jolloin portin 6200 kautta pääsee sisään..


## c) Snif snif. Selitä ja arvioi valitsemasi hyökkäyksen toimintaa verkkosnifferillä. Pohdi myös, miten näkyvä tämä hyökkäys tai kontrollikanava on verkossa. (Vapaaehtoinen bonus: liitä mukaan pcap tekemästäsi nauhoituksesta).

Nauhoitan hyökkäystä pienen pätkän verkkosnifferi Wiresharkilla.

![image](https://github.com/user-attachments/assets/19554c03-1fcc-4cbe-a6fe-6054ecb2274e)

Tästähän näkyy liikennettä kattavasti, ja näen kuvasta esim että rivillä 36 sourceip on Kalin, eli hyökkäävän koneen ip, ja destination metaspn ip. Näen mitä protokollaa on käytetty missäkin paketin siirrossa, tässä kohtaa TCP, ja mistä portista hyökkäys on mennyt mihin porttiin, montako bittia dataa on liikkunut missäkin kohtaa jne.

Tutkin tarkemmin kaapattua liikennettä wiresharkin eri osioilla;

statistics -> Conversationsista löytyy data jaoeteltuna;
![image](https://github.com/user-attachments/assets/d3773b22-8025-43b8-a346-91edaaf1bfef)

Otan tästä pcapin, mutta pcap on virtuaaliKalillani.

## d) Fuzzzz. Ratkaise dirfuz-1 artikkelista Karvinen 2023: Find Hidden Web Directories - Fuzz URLs with ffuf.

Aloitan dirfuz-0:sta, ja asennan Fuffin kalille.

![image](https://github.com/user-attachments/assets/e18ee93a-33e5-4ac8-b21e-f57d3a45067d)

![image](https://github.com/user-attachments/assets/4b6ab142-3686-411f-9a75-0ef33dc3683b)

Tallennan myös tuon common.textin.

![image](https://github.com/user-attachments/assets/fe9c7840-4f67-43ec-85c2-94eaaa4b1ad1)

Näyttää toimivan. 

Irrotan tässä kohtaa netin, niinkuin artikkelissa kehotetaan, ja fuzzaan annetulla komennolla `./ffuf -w common.txt -u http://127.0.0.2:8000/FUZZ`

Oma tulosteeni poikkeaa kuitenkin teron esimerkistä, sillä minulle ei tule tarkempaa tulostetta, vaan joka kerta näkyy tuo sama kuva, ja erroreita 4734. 

![image](https://github.com/user-attachments/assets/0bd8c7fb-df2d-4dd7-bae7-66ca0530bc66)

![image](https://github.com/user-attachments/assets/2052c596-d148-4a37-b16f-7d5a04067001)

Testaan toisella komennolla, ja sama homma. `./ffuf -w common.txt -u http://127.0.0.2:8000/FUZZ -fs 132`

![image](https://github.com/user-attachments/assets/48ee2781-6ae2-4604-a3b6-861041cc35a7)

Katson ohjeita ylöspäin ja löydänkin virheeni. Suljin yhteyden osoitteeseen, kun se olisi pitänyt jättää auki ja avata toiseen terminaaliin Fuffi.
Testaan uusiksi ja nyt toimii niinkuin pitikin.

![image](https://github.com/user-attachments/assets/ec2edd54-63d4-47be-8b52-0d6b4fb3fe47)

![image](https://github.com/user-attachments/assets/2428a8ae-b04c-4235-814b-71aaeed585aa)


Ok, lämmittelymaali ratkottu, oikean pariin.

Netti takaisin kiinni ja lataan nyt dir1;

    $ wget https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/dirfuzt-1
    $ chmod u+x dirfuzt-1
    $ ./dirfuzt-1

  ![image](https://github.com/user-attachments/assets/5ab4a71a-8b18-4e8f-8e05-ec929392ebe5)

Aletaan fuzzaamaan, ja aloitetaan annetusta esierkistä.

    $ ./ffuf -w common.txt -u http://127.0.0.2:8000/FUZZ

Inte.
Muokataan edellisen onnistunutta komentoa vastaamaan nykytilannetta, sillä useimmat näyttävät olevan outputiltaan 154 merkkisiä.

    $ ./ffuf -w common.txt -u http://127.0.0.2:8000/FUZZ -fs 154
  
![image](https://github.com/user-attachments/assets/5f148d7c-e559-4045-8c99-5a5affd7c907)

Testaan ensimmäistä selaimeen, .git ja oikein on, you found it.

![image](https://github.com/user-attachments/assets/8ecabca6-7d0b-45f3-8af4-146b2abae33f)

Jee.

## d) HTB. Ratkaise 1-2 konetta HackTheBoxisssa. Voit valita omaan taitotasoon sopivat koneet. "Starting point" ovat helppoja. "Labs" on vaikeampi, ja sieltä kannattaa valita helpoksi "Easy" merkitty kone. Nuo Easy:tkin ovat tarjoavat alussa haastetta, niistä riittää hyvin yksikin. Huomaa, että "Labs" ja "Starting point" ovat eri VPN-yhteyksien takana.

## e) Vapaaehtoinen, helppo: Vaihda 'micro' Metasploitin oletuseditoriksi. Sille on oma 'setg' asetus.

setg EDITOR micro.

## Lähteet:

https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/

https://terokarvinen.com/tunkeutumistestaus/
